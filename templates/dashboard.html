<!DOCTYPE html>
<html lang="pl">
<head>
    <title>ThunderT Admin</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #050505; color: #e0e0e0; font-family: 'Courier New', monospace; padding: 20px; }
        .card { background: #111; border: 1px solid #333; margin-bottom: 20px; }
        h1, h2, h5 { color: #FFD700; text-transform: uppercase; letter-spacing: 1px; }
        .btn-gold { background: #FFD700; color: #000; border: none; font-weight: bold; }
        .btn-gold:hover { background: #e6c200; }

        /* Tables */
        .table-dark { background-color: #111; --bs-table-bg: #111; border-color: #333; }
        th { color: #FFD700 !important; border-bottom: 1px solid #FFD700 !important; }

        /* Badges */
        .badge-basic { border: 1px solid #aaa; color: #aaa; }
        .badge-pro { border: 1px solid #00c853; color: #00c853; }
        .badge-enterprise { border: 1px solid #d500f9; color: #d500f9; box-shadow: 0 0 5px #d500f9; }

        .status-active { color: #00c853; }
        .status-expired { color: #ff9800; }
        .status-banned { color: #ff1744; text-decoration: line-through; }

        /* Logs */
        .log-critical { background: rgba(255, 23, 68, 0.1); border-left: 3px solid #ff1744; }
        .log-warning { border-left: 3px solid #ff9800; }

        /* Nav Tabs */
        .nav-tabs .nav-link { color: #888; border-color: #333; }
        .nav-tabs .nav-link.active { background-color: #111; border-color: #FFD700; border-bottom-color: #111; color: #FFD700; }
    </style>
</head>
<body>
    <div class="container-fluid" style="max-width: 1400px;">
        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom border-secondary pb-3">
            <div>
                <h1 class="mb-0">âš¡ ThunderT <small class="text-muted fs-5">v2.0</small></h1>
                <small class="text-muted">Admin: {{ admin_id }}</small>
            </div>
            <a href="/logout" class="btn btn-outline-secondary btn-sm">WYLOGUJ</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} py-2">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button">ZARZÄ„DZANIE LICENCJAMI</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button">LOGI BEZPIECZEÅƒSTWA ðŸš¨</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">

            <div class="tab-pane fade show active" id="home">
                <div class="card p-4">
                    <h5>NOWA LICENCJA</h5>
                    <form action="/create" method="POST" class="row g-3 align-items-end">
                        <div class="col-md-3">
                            <label class="text-muted small">Notatka</label>
                            <input type="text" name="note" class="form-control bg-dark text-white border-secondary" placeholder="Dla kogo?" required>
                        </div>
                        <div class="col-md-2">
                            <label class="text-muted small">Typ</label>
                            <select name="license_type" class="form-select bg-dark text-white border-secondary">
                                <option value="BASIC">BASIC</option>
                                <option value="PRO" selected>PRO</option>
                                <option value="ENTERPRISE">ENTERPRISE</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="text-muted small">Czas trwania</label>
                            <select name="duration" class="form-select bg-dark text-white border-secondary">
                                <option value="30">30 Dni</option>
                                <option value="90">90 Dni</option>
                                <option value="365">1 Rok</option>
                                <option value="lifetime">LIFETIME</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-gold w-100">GENERUJ</button>
                        </div>
                    </form>
                </div>

                <div class="card p-3">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>KLUCZ</th>
                                <th>TYP</th>
                                <th>STATUS</th>
                                <th>WYGASA</th>
                                <th>HWID / NOTATKA</th>
                                <th class="text-end">AKCJE</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lic in licenses %}
                            <tr>
                                <td class="font-monospace text-white">{{ lic.license_key }}</td>
                                <td>
                                    <span class="badge badge-{{ lic.license_type.lower() }}">{{ lic.license_type }}</span>
                                </td>
                                <td>
                                    {% if lic.status == 'banned' %}
                                        <span class="status-banned">BANNED</span>
                                    {% elif lic.is_expired or lic.status == 'expired' %}
                                        <span class="status-expired">EXPIRED</span>
                                    {% else %}
                                        <span class="status-active">ACTIVE</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if lic.expires_at %}
                                        <small>{{ lic.expires_at[:10] }}</small>
                                    {% else %}
                                        âˆž
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="small text-muted">{{ lic.hwid[:10] + '...' if lic.hwid else 'No HWID' }}</div>
                                    <div class="small text-white">{{ lic.note }}</div>
                                </td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-primary me-1"
                                            onclick="openEditModal('{{ lic.id }}', '{{ lic.note }}')">EDYCJA</button>

                                    {% if lic.hwid %}
                                    <form action="/action/reset_hwid/{{ lic.id }}" method="POST" class="d-inline">
                                        <button class="btn btn-sm btn-outline-info" title="Reset HWID">â™»</button>
                                    </form>
                                    {% endif %}

                                    {% if lic.status == 'banned' %}
                                    <form action="/action/unban/{{ lic.id }}" method="POST" class="d-inline">
                                        <button class="btn btn-sm btn-outline-success">UNBAN</button>
                                    </form>
                                    {% else %}
                                    <form action="/action/ban/{{ lic.id }}" method="POST" class="d-inline">
                                        <button class="btn btn-sm btn-outline-warning">BAN</button>
                                    </form>
                                    {% endif %}

                                    <form action="/action/delete/{{ lic.id }}" method="POST" class="d-inline" onsubmit="return confirm('UsunÄ…Ä‡?')">
                                        <button class="btn btn-sm btn-outline-danger">X</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-pane fade" id="logs">
                <div class="card p-3">
                    <h5 class="text-danger mb-3">OSTATNIE ZDARZENIA BEZPIECZEÅƒSTWA</h5>
                    <table class="table table-dark table-sm">
                        <thead>
                            <tr>
                                <th>CZAS</th>
                                <th>SEVERITY</th>
                                <th>WIADOMOÅšÄ†</th>
                                <th>IP</th>
                                <th>KLUCZ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in logs %}
                            <tr class="log-{{ log.severity }}">
                                <td class="text-muted">{{ log.created_at[:19] }}</td>
                                <td class="text-uppercase fw-bold {{ 'text-danger' if log.severity == 'critical' else 'text-warning' }}">
                                    {{ log.severity }}
                                </td>
                                <td>{{ log.message }} <br> <small class="text-muted">HWID: {{ log.hwid_attempt }}</small></td>
                                <td>{{ log.ip_address }}</td>
                                <td class="font-monospace small">{{ log.license_key }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-gold">EDYCJA LICENCJI</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="/edit_license" method="POST">
                    <div class="modal-body">
                        <input type="hidden" name="id" id="edit_id">

                        <div class="mb-3">
                            <label class="form-label text-muted">Edytuj NotatkÄ™</label>
                            <input type="text" name="note" id="edit_note" class="form-control bg-black text-white border-secondary">
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-muted">PrzedÅ‚uÅ¼ waÅ¼noÅ›Ä‡ o...</label>
                            <select name="extend_days" class="form-select bg-black text-white border-secondary">
                                <option value="0" selected>Nie przedÅ‚uÅ¼aj</option>
                                <option value="30">+30 Dni</option>
                                <option value="90">+90 Dni</option>
                                <option value="365">+1 Rok</option>
                            </select>
                            <small class="text-muted">Wybierz, aby dodaÄ‡ dni do obecnej daty.</small>
                        </div>
                    </div>
                    <div class="modal-footer border-secondary">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                        <button type="submit" class="btn btn-gold">Zapisz Zmiany</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function openEditModal(id, note) {
            document.getElementById('edit_id').value = id;
            document.getElementById('edit_note').value = note;
            var myModal = new bootstrap.Modal(document.getElementById('editModal'));
            myModal.show();
        }
    </script>
</body>
</html>